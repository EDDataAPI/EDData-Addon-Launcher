<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">

  <Package Name="EDData Addon Helper"
           Manufacturer="EDToolbox"
           Version="!(bind.FileVersion.MainExeFile)"
           UpgradeCode="7E8F9A0B-1C2D-4E5F-A6B7-C8D9E0F1A2B3">

    <!-- Upgrade detection - removes previous versions before installing new one -->
    <MajorUpgrade 
        DowngradeErrorMessage="A newer version of [ProductName] is already installed."
        AllowSameVersionUpgrades="yes"
        Schedule="afterInstallInitialize" />

    <MediaTemplate EmbedCab="yes" CompressionLevel="high" />

    <!-- Add/Remove Programs properties -->
    <Property Id="ARPURLINFOABOUT" Value="https://github.com/EDToolbox/Elite-Dangerous-Addon-Launcher-V2" />
    <Property Id="ARPURLUPDATEINFO" Value="https://github.com/EDToolbox/Elite-Dangerous-Addon-Launcher-V2/releases" />
    <Property Id="ARPCONTACT" Value="EDToolbox" />
    <Property Id="ARPCOMMENTS" Value="Launch and manage Elite Dangerous addons" />

    <!-- Installation directory -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="EDData Addon Helper" />
    </StandardDirectory>

    <!-- Start Menu -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="EDData Addon Helper" />
    </StandardDirectory>

    <!-- Desktop -->
    <StandardDirectory Id="DesktopFolder" />

    <!-- Main executable component with shortcuts -->
    <Component Id="MainExecutable" Directory="INSTALLFOLDER">
      <File Id="MainExeFile"
            Source="$(var.PublishDir)\EDData Addon Helper.exe"
            KeyPath="yes">
        <Shortcut Id="StartMenuShortcut"
                  Directory="ApplicationProgramsFolder"
                  Name="EDData Addon Helper"
                  Description="Launch Elite Dangerous addons"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="ProductIcon.ico" />
        <Shortcut Id="DesktopShortcut"
                  Directory="DesktopFolder"
                  Name="EDData Addon Helper"
                  Description="Launch Elite Dangerous addons"
                  WorkingDirectory="INSTALLFOLDER"
                  Icon="ProductIcon.ico" />
      </File>
    </Component>

    <!-- Cleanup shortcuts on uninstall -->
    <Component Id="ApplicationShortcutCleanup" Directory="ApplicationProgramsFolder">
      <RemoveFolder Id="CleanupShortcuts" On="uninstall" />
      <RegistryValue Root="HKCU"
                     Key="Software\EDToolbox\EDData Addon Helper"
                     Name="installed"
                     Type="integer"
                     Value="1"
                     KeyPath="yes" />
    </Component>

    <!-- Application icon -->
    <Icon Id="ProductIcon.ico" SourceFile="installer\icon.ico" />
    <Property Id="ARPPRODUCTICON" Value="ProductIcon.ico" />

    <!-- License -->
    <WixVariable Id="WixUILicenseRtf" Value="installer\License.rtf" />

    <!-- UI -->
    <ui:WixUI Id="WixUI_InstallDir" />
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <!-- Feature -->
    <Feature Id="Complete" Level="1">
      <ComponentRef Id="MainExecutable" />
      <ComponentGroupRef Id="PublishedFiles" />
      <ComponentRef Id="ApplicationShortcutCleanup" />
    </Feature>

  </Package>
</Wix>
